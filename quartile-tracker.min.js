//! Quartile Tracker, http://tpkn.me/
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function QuartileTracker(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!(e instanceof Element))throw new TypeError("Expected a DOM element");if("object"!==_typeof(t))throw new TypeError("Expected an Object");var o=r.treshold,n=void 0===o?1:o,a=r.auto_reset,i=void 0===a?1:a,c=r.verbose,l=void 0===c?0:c,s=0,f=0,p=0,u=e.loop;u&&(e.loop=0);for(var d=[],y=0,v=t.length;y<v;y++){var m=Object.assign({},t[y]);if(!m.hasOwnProperty("time"))throw new Error("[QT] tracker #"+(y+1)+" does not have the 'time' property set!");if(!m.hasOwnProperty("pixel")&&!m.hasOwnProperty("callback"))throw new Error("[QT] tracker #"+(y+1)+" does not have neither 'pixel' nor 'callback' property set!");var h=m.time,b=m.pixel,k=m.callback,w=parseFloat(h);if(isNaN(w)||w<0)throw new Error("[QT] tracker #"+(y+1)+" has invalid time format: unparsable number or it's less than 0!");m.in_percent="string"==typeof h&&h.indexOf("%")===h.length-1,m.has_pixel="string"==typeof b,m.has_callback="function"==typeof k,m.time=w,d.push(m)}function E(){s=e.duration,f=e.currentTime;for(var t=0,r=d.length;t<r;t++){var o=d[t];if(0!=o.active){var a=o.time,i=o.pixel,c=o.callback,l=o.in_percent,u=o.has_pixel,y=o.has_callback;p=l&&s>0?f/s*100:f,(n<=0&&p>=a||n>0&&p>=a&&p<=a+(l?100*n/s:n))&&(u&&x(i),y&&c(),o.active=0,Q("tracker ("+a+(l?"%":"sec")+"):",i))}}}function T(){i&&g(),u&&e.play()}function x(e){var t=new Image;t.src=e,t.onload=t.onerror=function(){t=null}}function g(){for(var e=0,t=d.length;e<t;e++)d[e].active=1;Q("all trackers are reset")}function _(){e.removeEventListener("timeupdate",E),e.removeEventListener("ended",T),Q("destroyed")}function Q(){l&&console.log("[QT]",Object.values(arguments).join(" "))}return e.addEventListener("timeupdate",E),e.addEventListener("ended",T),{reset:g,destroy:_}}"undefined"!=typeof module&&void 0!==module.exports?module.exports=QuartileTracker:"function"==typeof define&&define.amd?define([],(function(){return QuartileTracker})):window.QuartileTracker=QuartileTracker;