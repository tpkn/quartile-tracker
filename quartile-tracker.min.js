//! Quartile Tracker, http://tpkn.me/
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function QuartileTracker(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!(e instanceof Element))throw new TypeError("Expected a DOM element");if("object"!==_typeof(t))throw new TypeError("Expected an Object");var o=r.treshold,n=void 0===o?1:o,a=r.auto_reset,i=void 0===a?1:a,c=r.verbose,l=void 0===c?0:c,s=0,f=0,d=0,p=e.loop;p&&(e.loop=0);for(var u=[],v=0,y=t.length;v<y;v++){var m=Object.assign({},t[v]);if(!m.hasOwnProperty("time"))throw new Error("[QT] tracker #"+(v+1)+" does not have the 'time' property set!");if(!m.hasOwnProperty("pixel")&&!m.hasOwnProperty("callback"))throw new Error("[QT] tracker #"+(v+1)+" does not have neither 'pixel' nor 'callback' property set!");var h=m.time,b=m.pixel,k=m.callback,w=parseFloat(h);if(isNaN(w)||w<0)throw new Error("[QT] tracker #"+(v+1)+" has invalid time format: unparsable number or it's less than 0!");m.in_percent="string"==typeof h&&h.indexOf("%")===h.length-1,m.has_pixel="string"==typeof b,m.has_callback="function"==typeof k,m.time=w,u.push(m)}function E(){s=e.duration}function T(){f=e.currentTime;for(var t=0,r=u.length;t<r;t++){var o=u[t];if(0!=o.active){var a=o.time,i=o.pixel,c=o.callback,l=o.in_percent,p=o.has_pixel,v=o.has_callback;d=l&&s>0?f/s*100:f,(n<=0&&d>=a||n>0&&d>=a&&d<=a+(l?100*n/s:n))&&(p&&g(i),v&&c(),o.active=0,O("tracker ("+a+(l?"%":"sec")+"):",i))}}}function x(){i&&_(),p&&e.play()}function g(e){var t=new Image;t.src=e,t.onload=t.onerror=function(){t=null}}function _(){for(var e=0,t=u.length;e<t;e++)u[e].active=1;O("all trackers are reset")}function Q(){e.removeEventListener("loadedmetadata",E),e.removeEventListener("timeupdate",T),e.removeEventListener("ended",x),O("destroyed")}function O(){l&&console.log("[QT]",Object.values(arguments).join(" "))}return e.addEventListener("loadedmetadata",E),e.addEventListener("timeupdate",T),e.addEventListener("ended",x),{reset:_,destroy:Q}}"undefined"!=typeof module&&void 0!==module.exports?module.exports=QuartileTracker:"function"==typeof define&&define.amd?define([],(function(){return QuartileTracker})):window.QuartileTracker=QuartileTracker;